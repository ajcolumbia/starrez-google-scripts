{
  "cards": [
    {
      "header": {
        "title": "New Booking"
      },
      "sections": [
        {
          "widgets": [
            {
              "keyValue": {
                "topLabel": "Student",
                "content": "{NewData_EntryID.NameFirst} {NewData_EntryID.NameLast} ({NewData_EntryID.ID1})",
                "icon": "PERSON"
              }
            },
            {
              "keyValue": {
                "topLabel": "Room Space",
                "content": "{NewData_RoomSpaceID.WebDescription|NewData_RoomSpaceID.Description}",
                "icon": "HOTEL"
              }
            },
            {
              "keyValue": {
                "topLabel": "Room Profile",
                "content": "{SELECT ProfileItem FROM RoomConfiguration JOIN RoomConfigurationProfile WHERE RoomBaseID={NewData_RoomSpaceID.RoomBaseID} AND DateStart<={NewData_CheckInDate} AND DateEnd>{NewData_CheckInDate}}",
                "icon": "HOTEL_ROOM_TYPE"
              }
            },
            {
              "keyValue": {
                "topLabel": "Term Session",
                "content": "{NewData_TermSessionID.WebDescription|NewData_TermSessionID.Description}",
                "icon": "CLOCK"
              }
            }
          ]
        },
        {
          "widgets":
            {
              "buttons": [
                {
                  "textButton": {
                    "text": "VIEW BOOKING",
                    "onClick": {
                      "openLink": {
                        "url": "https://wfu.starrezhousing.com/StarRezWeb/main/directory#!entry:{NewData_EntryID}!booking:{NewData_BookingID}"
                      }
                    }
                  }
                },
                {
                  "textButton": {
                    "text": "VIEW ENTRY",
                    "onClick": {
                      "openLink": {
                        "url": "https://wfu.starrezhousing.com/StarRezWeb/main/directory#!entry:{NewData_EntryID}"
                      }
                    }
                  }
                }
              ]
            }
        }
      ],
    },
    {
      "header": {
        "title": "{NewData_RoomSpaceID.RoomBaseID.RoomLocationID.WebDescription|NewData_RoomSpaceID.RoomBaseID.RoomLocationID.Description}"
      },
      "sections": [
        {
          "widgets": [
            {
              "keyValue": {
                "topLabel": "Term Session",
                "content": "{NewData_TermSessionID.WebDescription|NewData_TermSessionID.Description}",
                "icon": "CLOCK"
              }
            }
          ]
        },
        {
          "widgets": [
            {
              "keyValue": {
                "topLabel": "Unblocked Beds Booked",
                "content": "{SELECT COUNT(BookingID) FROM Booking JOIN RoomSpace JOIN RoomBase JOIN RoomConfiguration ON RoomBase.RoomBaseID=RoomConfiguration.RoomBaseID AND DateStart<={NewData_CheckInDate} AND DateEnd>{NewData_CheckInDate} JOIN RoomConfigurationProfile ON RoomConfiguration.RoomConfigurationID=RoomConfigurationProfile.RoomConfigurationID AND ProfileItemID=50 WHERE CheckInDate<{NewData_CheckOutDate} AND CheckOutDate>{NewData_CheckInDate} AND EntryStatusEnum<>70 AND RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID}}"
              }
            },
            {
              "keyValue": {
                "topLabel": "Unblocked Beds Remaining",
                "content": "{SELECT {SELECT SUM(Capacity) FROM RoomConfiguration JOIN RoomType JOIN RoomBase JOIN RoomConfigurationProfile WHERE ProfileItemID=50 AND RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID} AND DateStart<={NewData_CheckInDate} AND DateEnd>{NewData_CheckInDate}}-{SELECT COUNT(BookingID) FROM Booking JOIN RoomSpace JOIN RoomBase JOIN RoomConfiguration ON RoomBase.RoomBaseID=RoomConfiguration.RoomBaseID AND DateStart<={NewData_CheckInDate} AND DateEnd>{NewData_CheckInDate} JOIN RoomConfigurationProfile ON RoomConfiguration.RoomConfigurationID=RoomConfigurationProfile.RoomConfigurationID AND ProfileItemID=50 WHERE CheckInDate<{NewData_CheckOutDate} AND CheckOutDate>{NewData_CheckInDate} AND RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID}}}"
              }
            },
            {
              "keyValue": {
                "topLabel": "Unblocked Capacity",
                "content": "{SELECT SUM(Capacity) FROM RoomConfiguration JOIN RoomType JOIN RoomBase JOIN RoomConfigurationProfile WHERE ProfileItemID=50 AND RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID} AND DateStart<={NewData_CheckInDate} AND DateEnd>{NewData_CheckInDate}}"
              }
            }
          ]
        },
        {
          "widgets": [
            {
              "keyValue": {
                "topLabel": "Total Beds Booked",
                "content": "{SELECT COUNT(RoomSpaceID) FROM Booking WHERE RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID} AND EntryStatusEnum<>70 AND CheckInDate<{NewData_TermSessionID.CheckOutDate} AND CheckOutDate>{NewData_TermSessionID.CheckInDate}}"
              }
            },
            {
              "keyValue": {
                "topLabel": "Total Beds Remaining",
                "content": "{SELECT {SELECT SUM(Capacity) FROM RoomConfiguration JOIN RoomType JOIN RoomBase WHERE RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID} AND DateStart<={NewData_CheckInDate} AND DateEnd>{NewData_CheckInDate}}-{SELECT COUNT(RoomSpaceID) FROM Booking WHERE RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID} AND EntryStatusEnum<>70 AND CheckInDate<{NewData_TermSessionID.CheckOutDate} AND CheckOutDate>{NewData_TermSessionID.CheckInDate}}}"
              }
            },
            {
              "keyValue": {
                "topLabel": "Operating Capacity",
                "content": "{SELECT SUM(Capacity) FROM RoomConfiguration JOIN RoomType JOIN RoomBase WHERE RoomLocationID={NewData_RoomSpaceID.RoomBaseID.RoomLocationID} AND DateStart<={NewData_CheckInDate} AND DateEnd>{NewData_CheckInDate}}"
              }
            }
          ]
        }
      ]
    }
  ]
}
